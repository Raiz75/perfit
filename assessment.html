<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Perfit</title>
    <style>
        *{
            box-sizing: border-box;
        }
        body{
            padding: 0;
            margin: 0;
            font-size: 16px;
            font-family: Arial, sans-serif;
        }

        /*banner*/
        .banner img{
            width: 100%;
        }
        .ttl{
            text-align: center;
            font-size: 4rem;
            color:rgb(128, 65, 128);
            margin-top: -25vw;
            margin-bottom: 20vw;
        }

        /*stepCounter*/
        .stepCounter{
            margin-top: 5vw;
            width: 90%;
            margin-left: auto;
            margin-right: auto;
            display: flex;
            margin-bottom: 2rem;
        }
        .stepContainer{
            display: flex;
            flex-direction: column;
            align-items: center; 
            justify-content: center;
            text-align: center;
            color: rgb(128, 65, 128);
            width: 10%;
        }
        .step {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background-color: rgb(255, 223, 255);
            color: rgb(128, 65, 128);
            display: flex;
            justify-content: center;
            align-items: center;
            font-weight: bold;
            margin: 8px;
            font-size: 1.2rem;
        }
        .line{
            flex: 1;
            height: 4px;
            background: rgb(255, 223, 255);
            margin-top: 32px;
        }
        .currentStep{
            background-color: rgb(128, 65, 128);
            color: white
        }

        /*personalDetail*/
        .personalDetail{
            width: 90%;
            max-width: 500px;
            margin: 2rem auto;
            text-align: center;
            border-radius: 8px;
            padding: 1rem;
            background-color: whitesmoke;
            box-shadow: 0 0 8px rgba(128, 128, 128, 0.3);
        }
        .personalDetail span{
            font-size: 0.9rem;
            color: grey;
            transition: .3s ease-in-out;
        }
        .box{
            width: auto;
            border-radius: 8px;
            padding: 0.75rem;
            text-align: left;
            margin: 1rem 0;
            border: 2px solid rgb(128, 65, 128);
            background-color: white;
        }
        .box input[type="number"]{
            width: 100%;
            max-width: 120px;
            height: 40px;
            border: 2px solid rgb(128, 65, 128);
            border-radius: 8px;
            background-color: white;
            padding: 0.5rem;
            font-size: 1rem;
        }

        /*skills*/
        .skillQuestion{
            width: 90%;
            margin: 0 auto;
            border-radius: 12px;
            display: none;
        }

        /*generalQuestion*/
        .generalQuestion{
            width: 90%;
            margin: 0 auto;
            border-radius: 12px;
        }

        /*question box*/
        .questionBox{
            width: 90%;
            margin: 2rem auto;
            text-align: center;
            padding: 1.5rem;
            background-color: whitesmoke;
            border-radius: 12px;
            box-shadow: 0 0 8px rgba(51, 26, 51, 0.3);
        }
        .questionText{
            width: 95%;
            font-size: 1.5rem;
            margin: 0 auto 1.5rem auto;
            color: rgb(128, 65, 128);
            line-height: 1.4;
        }
        .rateBox{
            margin: 1.5rem auto 0 auto;
            width: 100%;
            display: flex;
            flex-direction: column;
            gap: .5rem;
        }
        .rateBox button{
            font-size: 1rem;
            min-height: 50px;
            border-radius: 12px;
            border: 2px solid rgb(128, 65, 128);
            color: rgb(128, 65, 128);
            background-color: white;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        .rateBox button:hover{
            color: white;
            background-color: rgb(128, 65, 128);
        }
        .blurred {
            filter: blur(2px);
            /* pointer-events: none; */
            opacity: 0.9;
        }
        .denyInput {
            filter: blur(2px);
            pointer-events: none;
            opacity: 0.9;
        }
        .clicked {
            background-color: rgb(128, 65, 128) !important;
            color: white !important;
        }

        /*specific questions*/
        .specificQuestion{
            width: 90%;
            margin: 0 auto;
            display: none;
        }

        /*responseDiv*/
        .responseDiv{
            width: 90%;
            margin: 2rem auto;
            padding: 2rem;
            border: 3px solid rgb(128, 65, 128);
            border-radius: 12px;
            display: none;
        }

        /*next*/
        .nextBtn{
            width: 200px;
            height: 60px;
            border: 3px solid rgb(128, 65, 128);
            border-radius: 12px;
            font-size: 1.2rem;
            background-color: rgb(128, 65, 128);
            color: white;
            margin: 2rem auto;
            display: block;
            cursor: pointer;
            transition: .3s ease-in-out;
        }
        .nextBtn:hover{
            background-color: rgb(255, 223, 255);
            color: rgb(128, 65, 128);
        }
        .disable{
            pointer-events: none;
            border: 3px solid grey;
            background-color: rgb(196, 171, 196);
            color: grey;
        }

        /*footer*/
        .footer{
            background-image: url('img/footer.png');
            background-size: cover;
            width: 100%;
            height: 200px;
            position: relative;
            margin-top: 30vh;
        }

        /*alert*/
        .overlay {
            display: none;               /* hidden by default */
            position: fixed;             /* stays in place */
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.4); /* dark semi-transparent layer */
            backdrop-filter: blur(5px);        /* blur the content behind */
            z-index: 999;  /* above everything */
        }

        /* Centered alert */
        .showAlert {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            border: 3px solid rgb(128, 65, 128);
            width: 500px;
            height: 300px;
            background: white;
            padding: 2rem;
            text-align: center;
            font-size: 1.17rem;
            border-radius: 12px;
        }
        .showAlert button{
            border: 3px solid rgb(128, 65, 128);
            padding: 10px;
            width: 50%;
            background-color: rgb(128, 65, 128);
            border-radius: 12px;
            color: white;
            font-size: 1.2rem;
        }

        /*puzzle*/
        .puzzle{
            width: 40vw;
            height: 40vw;
            position: absolute;
            bottom:0vw;
            left: 0vw;
            background: radial-gradient(circle, rgb(128, 65, 128) 10%, transparent 70%);
            z-index: -5;
        }
        .puzzle img{
            width: 15vw;
            height: 15vw;
        }
        .bottom{
            position: absolute;
            bottom:5vw;
            left:13vw;
            opacity: 0;
            filter: drop-shadow(0vw 0vw 3vw rgb(255, 255, 255));
            transform: scale(1.2);
            transition: 1s ease-in-out;
        }
        .left{
            position: absolute;
            top:13.1vw;
            left:4.9vw;
            opacity: 0;
            filter: drop-shadow(0vw 0vw 3vw rgb(255, 255, 255));
            transform: scale(1.2);
            transition: 1s ease-in-out;
        }
        .right{
            position: absolute;
            top:11.8vw;
            right:5.1vw;
            opacity: 0;
            filter: drop-shadow(0vw 0vw 3vw rgb(255, 255, 255));
            transform: scale(1.2);
            transition: 1s ease-in-out;
        }
        .top{
            position: absolute;
            top:5vw;
            left:11.7vw;
            opacity: 0;
            filter: drop-shadow(0vw 0vw 3vw rgb(255, 255, 255));
            transform: scale(1.2);
            transition: 1s ease-in-out;
        }
        .showPiece{
            transform: scale(1);
            filter: drop-shadow(0vw 0vw 0vw rgb(255, 255, 255));
            opacity: 1;
        }
        .highlightPiece{
            filter: drop-shadow(0vw 0vw 5vw rgb(255, 255, 255));
        }
        /*test*/
        .testBtn{
            position: absolute;
            top: 0;
            right: 0;
            width: 80px;
            height: 80px;
            display: none;
        }

        /* Mobile Responsive Media Queries */
        @media screen and (max-width: 768px) {
            .banner{
                height: 30vh;
            }
            .ttl {
                font-size: 2.5rem;
                margin-top: -10vw;
                margin-bottom: 15vw;
            }
            
            .stepCounter {
                width: 95%;
                margin-top: 8vw;
            }
            
            .step {
                width: 50px;
                height: 50px;
                font-size: 1rem;
                margin: 4px;
            }
            .stepContainer{
                width: 20%;
            }
            .line {
                height: 3px;
                margin-top: 26px;
            }
            
            .personalDetail {
                width: 95%;
                padding: 1rem;
            }
            
            .questionText {
                font-size: 1.3rem;
            }
            
            .rateBox {
                gap: 0.3rem;
            }
            
            .rateBox button {
                height: 45px;
                min-height: 45px;
                font-size: 0.9rem;
            }
            
            .nextBtn {
                width: 180px;
                height: 50px;
                font-size: 1.1rem;
            }
            
            .footer {
                height: 150px;
                margin-top: 3rem;
            }

            .showAlert{
                width: 300px;
                padding: 1.5rem;
                font-size: .98rem;
            }
        }

        @media screen and (max-width: 480px) {
            body {
                font-size: 14px;
            }
            .banner img{
                height: 30vh;
            }
            .ttl {
                font-size: 2rem;
                margin-top: -50vw;
            }
            
            .stepCounter {
                flex-wrap: wrap;
                justify-content: center;
            }
            
            .step {
                width: 40px;
                height: 40px;
                font-size: 0.9rem;
                margin: 3px;
            }
            .stepContainer{
                width: 20%;
            }
            
            .line {
                display: none;
            }
            
            .questionText {
                font-size: 1.1rem;
                width: 100%;
            }
            
            .rateBox {
                grid-template-columns: repeat(4, 1fr);
                gap: 0.5rem;
            }
            
            .rateBox button {
                height: 40px;
                min-height: 40px;
                font-size: 0.8rem;
            }
            
            .nextBtn {
                width: 150px;
                height: 45px;
                font-size: 1rem;
            }
            
            .box input[type="number"] {
                height: 35px;
                font-size: 0.9rem;
            }
            
            .footer {
                height: 120px;
            }
            
            
        }
    </style>
</head>
<body>
<!--banner-->
    <div class="banner">
        <img src="img/banner-cut.png">
        <p class="ttl move-up">ASSESSMENT</p>
    </div>
<!--step-->
    <div class="stepCounter move-up">
        <div class="stepContainer">
            <p class="step currentStep">1</p>
            <p>Personal Details</p>
        </div>
        <p class="line" id="l1"></p>
        <div class="stepContainer">
            <p class="step" id="s2">2</p>
            <p>Skill Profiling</p>
        </div>
        <p class="line" id="l2"></p>
        <div class="stepContainer">
            <p class="step" id="s3">3</p>
            <p>Interest & Passion Profiling</p>
        </div>
        <p class="line" id="l3"></p>
        <div class="stepContainer">
            <p class="step" id="s4">4</p>
            <p>Behavioral Profiling</p>
        </div>
        <p class="line" id="l4"></p>
        <div class="stepContainer">
            <p class="step" id="s5">5</p>
            <p>Result</p>
        </div>
    </div>
<!--personal details-->
    <div class="personalDetail move-up" id="personalForm">
        <h2>DEMOGRAPHICS</h2>
        <div class="box move-up" id="genderBox">
            <span id="genderBoxttl">Gender</span><br>
            <label><input type="radio" name="genderBox" value="1"> Male</label>
            <label><input type="radio" name="genderBox" value="2"> Female</label>
        </div>
        <div class="box move-up" id="ageBox">
            <span id="ageBoxttl" >Age</span><br>
            <input type="number" name="ageBox" id="ageInput" min="1" max="100">
            <label for="ageBox">Years</label>
        </div>
        <div class="box move-up" id="statusBox">
            <span id="statusBoxttl">Status</span><br>
            <label><input type="radio" name="statusBox" value="1"> Single</label>
            <label><input type="radio" name="statusBox" value="2"> Married</label>
        </div>
        <div class="box move-up" id="baptizedBox">
            <span id="baptizedBoxttl">Baptized</span><br>
            <label><input type="radio" name="baptizedBox" value="1"> No</label>
            <label><input type="radio" name="baptizedBox" value="2"> Yes</label>
        </div>
        <div class="box move-up" id="timeInFaithBox">
            <span id="timeInFaithBoxttl">Time In Faith</span><br>
            <label><input type="radio" name="timeInFaithBox" value="1"> New</label><br>
            <label><input type="radio" name="timeInFaithBox" value="2"> More than 6 months</label><br>
            <label><input type="radio" name="timeInFaithBox" value="3"> More than 1 year</label>
        </div>
    </div>
<!--skill details-->
    <div class="skillQuestion" id="skillQuestion">
    </div>
<!--general questions-->
    <div class="ministryCategory" id="ministryCategory">
    </div>
<!--specific questions-->
    <div class="ministrySpecific" id="ministrySpecific">
    </div>
<!--alert-->
   <div id="overlay" class="overlay">
        <div class="showAlert">
            <p id="alertMessage">alert message here</p>
            <button onclick="window.location.href = 'index.html'">CLOSE</button>
        </div>
    </div>
    <!-- <p>Base on your Personal & Skill Profiling Interest & Passion Profiling</p> -->
<!--question box template-->
    <template id="questionTemp">
        <div class="questionBox">
            <p class="questionText">//test question//</p>
            <div class="rateBox">
                <button value=3>Strongly Agree</button>
                <button value=2>Agree</button>
                <button value=1>Slightly Agree</button>
                <button value=0>Neutral</button>
                <button value=-1>Slightly Disagree</button>
                <button value=-2>Disagree</button>
                <button value=-3>Strongly Disagree</button>
            </div>
        </div>
    </template>
<!--response div-->
    <div class="responseDiv" id="responseDiv">
        <h1 style="color:rgb(128, 65, 128);text-align: center;">CALLING AND SERVICE PROFILE</h1>
        <div id="thinking" style="display:none; font-weight: bold; font-size: 1.2em;">Analyzing your gifts and calling<span id="dots">.</span></div>
    </div>
<!--next button-->
    <button class="move-up nextBtn" id="step1" onclick="personalDetailsSubmit()">NEXT</button>
    <button class="move-up nextBtn" id="step2" style="display:none;" onclick="showMinistryCategory()">NEXT</button>
    <button class="move-up nextBtn" id="step3" style="display:none;" onclick="filter()">NEXT</button>
    <button class="move-up nextBtn" id="step4" style="display:none;" onclick="interpret()">SUBMIT</button>
    <button class="move-up nextBtn" id="step5" style="display:none;" onclick="window.location.href = 'index.html'">DONE</button>

    <!-- <button class="testBtn" id="submitGeneralQuestion" onclick="displaySpecificQuestions()">test</button> -->
<!--footer puzzle-->
    <div class="footer">
        <div class="puzzle" id="puzzle">
            <img class="bottom" id="bottom" src="img/y-bottom.png">
            <img class="left" id="left" src="img/x-left.png">
            <img class="right" id="right" src="img/x-right.png">
            <img class="top" id="top" src="img/y-bottom.png">
         </div>
     </div>
<!--script-->
    <script src="callApi.js"></script>
    <script>
    //varibales
        let gender=0;
        let age=0;
        let status=0;
        let baptized=0;
        let timeInFaith=0;
    //personal details
        function personalDetailsSubmit(){
            const genderAns = document.querySelector("input[name='genderBox']:checked");
            const ageAns = document.querySelector("input[name='ageBox']").value;
            const statusAns = document.querySelector("input[name='statusBox']:checked");
            const baptizedAns = document.querySelector("input[name='baptizedBox']:checked");
            const timeInFaithAns = document.querySelector("input[name='timeInFaithBox']:checked");
            if (!genderAns) {
                document.getElementById('genderBox').scrollIntoView({ behavior: 'smooth', block: 'center' });
                let blink = 0;
                const blinkInterval = setInterval(() => {
                    document.getElementById('genderBoxttl').style.color = (blink % 2 === 0) ? "red" : "grey";
                    document.getElementById('genderBoxttl').style.fontSize = (blink % 2 === 0) ? "1em" : ".8em";
                    document.getElementById('genderBox').style.borderColor = (blink % 2 === 0) ? "red" : "rgb(128, 65, 128)";
                    blink++;
                    if (blink > 5) clearInterval(blinkInterval);
                }, 300);
            }else if (ageAns<1 || ageAns>100) {
                document.getElementById('ageBox').scrollIntoView({ behavior: 'smooth', block: 'center' });
                let blink = 0;
                const blinkInterval = setInterval(() => {
                    document.getElementById('ageBoxttl').style.color = (blink % 2 === 0) ? "red" : "grey";
                    document.getElementById('ageBoxttl').style.fontSize = (blink % 2 === 0) ? "1em" : ".8em";
                    document.getElementById('ageBox').style.borderColor = (blink % 2 === 0) ? "red" : "rgb(128, 65, 128)";
                    document.getElementById('ageInput').value = '';
                    blink++;
                    if (blink > 5) clearInterval(blinkInterval);
                }, 300);
            }else if (!statusAns) {
                document.getElementById('statusBox').scrollIntoView({ behavior: 'smooth', block: 'center' });
                let blink = 0;
                const blinkInterval = setInterval(() => {
                    document.getElementById('statusBoxttl').style.color = (blink % 2 === 0) ? "red" : "grey";
                    document.getElementById('statusBoxttl').style.fontSize = (blink % 2 === 0) ? "1em" : ".8em";
                    document.getElementById('statusBox').style.borderColor = (blink % 2 === 0) ? "red" : "rgb(128, 65, 128)";
                    blink++;
                    if (blink > 5) clearInterval(blinkInterval);
                }, 300);
            }else if (!baptizedAns) {
                document.getElementById('baptizedBox').scrollIntoView({ behavior: 'smooth', block: 'center' });
                let blink = 0;
                const blinkInterval = setInterval(() => {
                    document.getElementById('baptizedBoxttl').style.color = (blink % 2 === 0) ? "red" : "grey";
                    document.getElementById('baptizedBoxttl').style.fontSize = (blink % 2 === 0) ? "1em" : ".8em";
                    document.getElementById('baptizedBox').style.borderColor = (blink % 2 === 0) ? "red" : "rgb(128, 65, 128)";
                    blink++;
                    if (blink > 5) clearInterval(blinkInterval);
                }, 300);
            }else if (!timeInFaithAns) {
                document.getElementById('timeInFaithBox').scrollIntoView({ behavior: 'smooth', block: 'center' });
                let blink = 0;
                const blinkInterval = setInterval(() => {
                    document.getElementById('timeInFaithBoxttl').style.color = (blink % 2 === 0) ? "red" : "grey";
                    document.getElementById('timeInFaithBoxttl').style.fontSize = (blink % 2 === 0) ? "1em" : ".8em";
                    document.getElementById('timeInFaithBox').style.borderColor = (blink % 2 === 0) ? "red" : "rgb(128, 65, 128)";
                    blink++;
                    if (blink > 5) clearInterval(blinkInterval);
                }, 300);
             }else {
                document.getElementById('step1').classList.add("disable");
                //record variables
                gender = document.querySelector('input[name="genderBox"]:checked')?.value || "";
                age = document.querySelector('input[name="ageBox"]')?.value || "";
                status = document.querySelector('input[name="statusBox"]:checked')?.value || "";
                baptized = document.querySelector('input[name="baptizedBox"]:checked')?.value || "";
                timeInFaith = document.querySelector('input[name="timeInFaithBox"]:checked')?.value || "";
                console.log(">>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>");
                console.log(">> Personal Profile");
                console.log("gender[1=male 2=female]: "+gender);
                console.log("age: "+age);
                console.log("status[1=single 2=married]: "+status);
                console.log("baptized[1=no 2=yes]: "+baptized);
                console.log("time in faith[1-new 2=6mth 3=1yr]: "+ timeInFaith);
                console.log(">>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>");
                console.log("");
                showPuzzle("bottom");
                setTimeout(function() {
                    document.getElementById('personalForm').style.display = "none";
                    document.getElementById('step1').style.display = "none";
                    document.getElementById('step2').style.display = "block";
                    document.getElementById('step2').classList.add("disable");
                    document.getElementById('l1').classList.add("currentStep");
                    document.getElementById('s2').classList.add("currentStep");
                    document.getElementById('skillQuestion').style.display = "block";
                    skillSubmit();
                }, 3500);
            }
        };

    //skill questions
        const skillProfilingQuestions = [
            // Musical, Instrumental, Singing Skills
            "I have skills in music, singing, or playing instruments.",
            "Music is a regular part of my activities or hobbies.",
            "I’ve had opportunities in the past to perform or be part of musical events.",
            "I’m open to training or workshops to enhance my musical abilities.",
            "I enjoy collaborating with others in musical performances.",
        
            // Technological, Computer, Editing Skills
            "I can easily work with computers, technology, or media tools.",
            "I use technology for creative or problem-solving tasks on a regular basis.",
            "In the past, I’ve worked on projects involving editing, design, or coding.",
            "I’m interested in learning new tech skills to expand my capabilities.",
            "I would like to use my technical skills to support church tasks.",
        
            // Writing Skills
            "I’m able to put ideas into clear and engaging writing.",
            "Writing is something I do frequently in my personal or professional life.",
            "I’ve had past experiences creating articles, reports, or scripts.",
            "I’d like to further develop my writing abilities through practice or training.",
            "I’d like to contribute to church-related materials, articles, or programs through writing.",
        
            // Technical, Electrical, Plumbing Skills
            "I’m skilled in fixing, building, or handling technical tasks.",
            "I often work on repair, maintenance, or hands-on technical projects.",
            "I have previous experience in electrical, plumbing, or mechanical work.",
            "I’d like to learn more about technical skills through guided training.",
            "I’m willing to help the church with technical, electrical, or repair needs.",
        
            // Public Speaking Skills
            "I feel confident speaking to or leading a group of people.",
            "I regularly speak or present in front of audiences, big or small.",
            "I’ve had experience delivering talks, announcements, or presentations.",
            "I’m open to improving my public speaking through workshops or practice.",
            "I’d like to contribute to church-related materials, articles, or programs through writing.",
        
            // Accounting Skills
            "I’m good at keeping track of money, budgets, or financial records.",
            "I currently handle tasks that involve budgeting or expense tracking.",
            "I’ve had experience managing finances for a project or group.",
            "I’m willing to learn more about proper financial management.",
            "I’d like to assist in handling finances or budgets for church activities.",
        
            // Mentoring/Counseling Ability
            "I have a natural ability to guide, encourage, or advise others.",
            "I regularly help people through mentoring, counseling, or coaching.",
            "I’d like to assist in handling finances or budgets for church activities.",
            "I’m open to training that will make me a better mentor or counselor.",
            "I’d like to mentor or counsel people as part of church service.",
        
            // Understanding of Bible and Scripture
            "I feel confident in my understanding of Biblical stories and principles.",
            "I often study and discuss the Bible.",
            "I’ve had experience teaching or sharing lessons from Scripture.",
            "I’d like to deepen my understanding of the Bible through study.",
            "I’d like to share my knowledge of Scripture in church activities."
        ];

        let skillProfilingScore = [0,0,0,0,0,0,0,0];
        let skill=[];
        function skillSubmit(){
            //show question
            if(age<13){
                document.getElementById("overlay").style.display = "block";
                document.getElementById("alertMessage").innerText = "it appears that you are not yet old enough to serve in a ministry. We encourage you to continue growing in your faith and spiritual journey. When the time is right, we would love to see you involved. God bless you on your path of growth and readiness.";
                console.log("The user is not old enough yet");
            }
            console.log(">>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>");
            console.log(">> Skill Profile");
            showQuestions("skillQuestion", skillProfilingQuestions, skillProfilingScore, "step2");
        }
    //interest and passion questions
        const interestAndPassionProfiling = [
            //core ministry
            "I enjoy helping others learn and grow a relationship with God.",
            "I like participating in or helping lead worship, prayer, or Bible study.",
            "I’m interested in regularly engaging with specific age groups (children, youth, young adults, men/women).",
            "I like sharing biblical ideas and supporting others in their spiritual journey.",
            "I’d like to be part of ministries that focus on spiritual growth and discipleship.",

            //support ministry
            "I’m interested in working behind the scenes to help the church run smoothly.",
            "I enjoy organizing events, managing tasks, or helping with logistics.",
            "I like paying attention to details and making sure things run efficiently.",
            "I enjoy helping create a welcoming and organized church environment.”",
            "I’d like to be involved in roles such as ushering, administration, hospitality, or facility care",

            //outreach ministry
            "I am motivated to assist individuals beyond the church community.",
            "Sharing my faith and helping others experience God’s love is important to me.",
            "I feel a personal calling toward community outreach and service.",
            "I am interested about going where people are hurting and bringing hope.",
            "I am interested in participating in ministries focused on evangelism and community impact.",

            //creative & media ministry
            "I am passionate about using my creative talents and interests for God's glory.",
            "I enjoy working with visuals, media, technology, or the arts to communicate messages.",
            "I find fulfillment and energy in creating content, managing social media, or coordinating live events.",
            "I would like to help improve the church’s communication and engagement through creative means.",
            "I am interested in using my skills in drama, dance, video, graphic design, or tech to contribute to ministry.",
            
            //care & healing ministry
            "I feel sincere and have a desire to help those who are hurting or in need.",
            "I am a good listener and often find people sharing their struggles with me.",
            "I feel strongly called to help others heal emotionally, spiritually, or physically.",
            "I sense a calling to help others heal emotionally, spiritually, or physically.",
            "I am open and eager to serve in counseling, healing prayer, or support ministries.",

            //special interest ministry
            "I am interested in ministering to specific groups such as seniors, singles, or working professionals.",
            "I enjoy connecting with others who share common interests or hobbies (e.g., sports, writing).",
            "I believe my personal experiences and skills can positively contribute to others’ growth.",
            "I would enjoy leading or participating in ministries that align with my current life season or stage.",
            "I feel drawn to serve in creative or unconventional ministry areas that embrace unique interests."
        ];
        let interestAndPassionProfilingScore = [0,0,0,0,0,0];
        function showMinistryCategory() {
            document.getElementById('step2').classList.add("disable");
            //record skill
            for (let i = 0; i < skillProfilingScore.length; i++) {
                if(skillProfilingScore[i]>=5){
                    skill = skill.concat(i);
                }
            }
            console.log("music,technology,writing,technical,speaking,accounting,mentoring,bible: "+skill);
            showPuzzle("left");
                setTimeout(function() {
                    document.getElementById('skillQuestion').style.display = "none";
                    document.getElementById('step2').style.display = "none";
                    document.getElementById('step3').style.display = "block";
                    document.getElementById('step3').classList.add("disable");
                    document.getElementById('l2').classList.add("currentStep");
                    document.getElementById('s3').classList.add("currentStep");
                    document.getElementById('ministryCategory').style.display = "block";

                    //record skill
                    for (let i = 0; i < skillProfilingScore.length; i++) {
                        if(skillProfilingScore[i]>=10){
                            skill = skill.concat(i+1);
                        }
                    }
                    console.log(">>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>");
                    console.log("");
                    console.log(">>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>");
                    console.log(">> Ministry(Category) Profile");
                    showQuestions("ministryCategory", interestAndPassionProfiling, interestAndPassionProfilingScore, "step3");
                }, 3500);
        }
    
    //filter
        const ministries = [
        //core ministry/
            ["Worship","Prayer","Preaching","Discipleship","Children's",
            "Youth","Young Adults","Men's","Women's","Family Or Couples"],
        //support ministry
            ["Ushering","Hospitality","Administrative","Finance","Security","Facilities Maintenance"],
        //outreach ministry
            ["Evangelism","Missions","Community Service","Visitation","New Believers"],
        //creative and media ministry/
            ["Production Tech","Creative Arts","Communications & Social Media","Graphic & Video Design"],
        //care and healing ministry
            ["Counseling","Healing & Deliverance","Grief & Bereavement","Addiction Recovery","Special Needs"],
        //special interest ministry
            ["Seniors","Single Adults","Marketplace","Sports","Writing Publications"]
        ];
        let ranks = [0,0,0,0,0,0];
        let highest = [];
        let q = 0;
        let ministryInterest = [];
        function filter(){
            document.getElementById('step3').classList.add("disable");
            console.log(">>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>");
            console.log("");
            console.log(">>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>");
            console.log(">> Applying Filter");
            //combine all ministry interest
            for (let i = 0; i < highest.length; i++) {
                let min = highest[i];
                ministryInterest = ministryInterest.concat(ministries[min]);
            }
            //populate the ranks
            for(let i = 0; i < interestAndPassionProfilingScore.length; i++) {
                ranks[i]=interestAndPassionProfilingScore[i];
            }
        //find the highest category scorer(can be multiple)
            for (let i = 0; i < ranks.length; i++) {
                for (let j = i+1; j < ranks.length; j++) {
                    if (ranks[i] < ranks[j]) { 
                        // Swap elements
                        const temp = ranks[i];
                        ranks[i] = ranks[j];
                        ranks[j] = temp;
                    }
                }
            }
            //top scorer
            for (let i = 0; i < ranks.length; i++) {
                if(ranks[0]==interestAndPassionProfilingScore[i]){
                    highest[q]=i;
                    q++;
                }
            }
            //combine all ministry interest questions
            for (let i = 0; i < highest.length; i++) {
                let min = highest[i];
                ministryInterest = ministryInterest.concat(ministries[min]);
            }
        //test
            console.log(">> Ministry Interest(raw)");
            console.log(ministryInterest.join(", "));
        //apply restriction
            //gender filter
            let maleRestriction = ["Women's"];
            let femaleRestriction = ["Men's", "Preaching"];
            if (gender == "1") { // male
                ministryInterest = ministryInterest.filter(item => !maleRestriction.includes(item));
            } else if (gender == "2") { // female
                ministryInterest = ministryInterest.filter(item => !femaleRestriction.includes(item));
            }
            console.log(">> Gender filter Applied");
            //age filter
            let age13Restriction = ["Prayer","Preaching","Seniors","Single Adults","Marketplace","Writing Publications","Evangelism","Counseling","Healing & Deliverance","Grief & Bereavement","Addiction Recovery","Special Needs","Missions","Communications & Social Media","Visitation","New Believers","Discipleship","Children's","Young Adults","Men's","Women's","Family Or Couples","Administrative","Finance","Security","Facilities Maintenance"];
            let age16Restriction = ["Prayer","Visitation","Seniors","Single Adults","Marketplace","New Believers","Preaching","Counseling","Healing & Deliverance","Grief & Bereavement","Addiction Recovery","Young Adults","Men's","Women's","Family Or Couples","Administrative","Finance","Security"];
            let age18Restriction = ["Seniors","Family Or Couples","Finance","Counseling","Healing & Deliverance"];
            let age21Restriction = ["Youth","Seniors"];
            let age60Restriction = ["Youth","Young Adults","Marketplace"];
            if(age>=60){
                ministryInterest = ministryInterest.filter(item => !age60Restriction.includes(item));
            }else if(age>=21){
                ministryInterest = ministryInterest.filter(item => !age21Restriction.includes(item));
            }else if(age>=18){
                ministryInterest = ministryInterest.filter(item => !age18Restriction.includes(item));
            }else if(age>=16){
                ministryInterest = ministryInterest.filter(item => !age16Restriction.includes(item));
            }else if(age>=13){
                ministryInterest = ministryInterest.filter(item => !age13Restriction.includes(item));
            }
            console.log(">> Age filter Applied");
            //baptized filter
            let nonBaptizedRestriction = ["Worship","Counseling","Healing & Deliverance","Evangelism","Missions","Visitation","New Believers","Finance","Prayer","Preaching","Discipleship","Children's",];
            if (baptized == "1") { // not Baptized
                ministryInterest = ministryInterest.filter(item => !nonBaptizedRestriction.includes(item));
            }
            console.log(">> Baptized/Non-Baptized filter Applied");
            //status
            let singleRestriction = ["Family Or Couples"];
            let marriedRestriction = ["Single Adults"];
            if (status == "1") { // singleRestriction
                ministryInterest = ministryInterest.filter(item => !singleRestriction.includes(item));
            }else if(status == "2"){//marriedRestriction
                ministryInterest = ministryInterest.filter(item => !marriedRestriction.includes(item));
            }
            console.log(">> Status filter Applied");
            //time in faith filter
            let newComerRestriction = ["Counseling","New Believers","Healing & Deliverance","Marketplace","Grief & Bereavement","Addiction Recovery","Worship","Evangelism","Communications & Social Media","Missions","Visitation","Administrative","Finance","Security","Prayer","Preaching","Discipleship","Children's","Youth","Young Adults","Men's","Women's","Family Or Couples"];
            let sixMonthRestriction = ["Preaching","Finance","Counseling","Healing & Deliverance","Discipleship","New Believers"];
            if (timeInFaith == "1") { // singleRestriction
                ministryInterest = ministryInterest.filter(item => !newComerRestriction.includes(item));
            }else if(timeInFaith == "2"){//marriedRestriction
                ministryInterest = ministryInterest.filter(item => !sixMonthRestriction.includes(item));
            }
            console.log(">> Time in Faith filter Applied");
            //skill filter
            if(!skill.includes("1")){
                ministryInterest = ministryInterest.filter(item => item !== "Worship");
            }
            if(!skill.includes("2")){
                ministryInterest = ministryInterest.filter(item => item !== "Administrative");
                ministryInterest = ministryInterest.filter(item => item !== "Production Tech");
                ministryInterest = ministryInterest.filter(item => item !== "Graphic & Video Design");
                ministryInterest = ministryInterest.filter(item => item !== "Communications & Social Media");
            }
            if(!skill.includes("3")){
                ministryInterest = ministryInterest.filter(item => item !== "Writing Publications");
                ministryInterest = ministryInterest.filter(item => item !== "Communications & Social Media");
            }
            if(!skill.includes("4")){
                ministryInterest = ministryInterest.filter(item => item !== "Facilities Maintenance");
            }
            if(!skill.includes("5") && !skill.includes(8)){
                ministryInterest = ministryInterest.filter(item => item !== "Preaching");
                ministryInterest = ministryInterest.filter(item => item !== "Evangelism");
            }
            if(!skill.includes("6")){
                ministryInterest = ministryInterest.filter(item => item !== "Finance")
                ministryInterest = ministryInterest.filter(item => item !== "Marketplace");
            }
            if(!skill.includes("7")){
                ministryInterest = ministryInterest.filter(item => item !== "Discipleship")
                ministryInterest = ministryInterest.filter(item => item !== "Counseling");
                ministryInterest = ministryInterest.filter(item => item !== "New Believers");
            }
            if(!skill.includes("8")){
                ministryInterest = ministryInterest.filter(item => item !== "Preaching");
                ministryInterest = ministryInterest.filter(item => item !== "Evangelism");
                ministryInterest = ministryInterest.filter(item => item !== "New Believers");
            }
            console.log(">> Skill filter Applied");
            console.log(">> Ministry Interest(filtered)");
            console.log(ministryInterest.join(", "));
            showMinistrySpecific();
        }
    
        //behavioral questions
        const ministryQuestions = [
            // Core ministry
            {
                "ministry": "Worship",
                "questions": [
                    "Being in a space filled with music, rehearsals, and live worship excites me.",
                    "I am interested in leading others through singing, playing instruments, or creative expression.",
        	        "I have the musical talent, stage presence, or teamwork needed for worship ministry.",
                    "Serving in worship fits well with my personality and interests.",
                    "I have thought seriously about joining the worship team before."
                ]
            },
            {
                "ministry": "Prayer",
                "questions": [
                    "A peaceful, prayer-focused environment would be fulfilling for me.",
                    "I am willing to spend regular time interceding for people, the church, and world needs.",
                    "I have the focus, persistence, and spiritual sensitivity to serve in prayer ministry.",
                    "I believe I would serve well in a ministry centered on prayer.",
                    "I think I would serve well in a ministry centered on prayer."
                ]
            },
            {
                "ministry": "Preaching",
                "questions": [
                    "I would enjoy spending time studying, preparing, and discussing God’s Word.",
                    "I want to share biblical truths through preaching or teaching.",
                    "I have the speaking ability, clarity, and understanding needed to communicate Scripture effectively.",
                    "I think preaching or teaching is a ministry where I could contribute greatly.",
                    "I have considered stepping into a preaching or teaching role before."
            ]
            },
            {
                "ministry": "Discipleship",
                "questions": [
                    "I enjoy being in settings where people are guided and mentored in their faith.",
                    "I am motivated to invest in others’ spiritual growth over time.",
                    "I feel I have the patience, consistency, and listening skills that discipleship requires.",
                    "I believe walking alongside others in faith is a good fit for me.",
                    "I have thought about being part of a discipleship ministry in the past."
                ]
            },
            {
                "ministry": "Children's",
                "questions": [
                    "I would enjoy being in a lively, creative environment filled with children.",
                    "I am interested in teaching, guiding, and caring for kids in a faith context.",
                    "I feel I have the patience, energy, and creativity to engage well with children.", 
                    "I believe I can contribute effectively to a ministry focused on children’s growth and faith.",        
                    "I have considered joining the children’s ministry before."
                ]
            },
            {
                "ministry": "Youth",
                "questions": [
                    "I would feel energized in a setting filled with teens and youth activities.",
                    "I feel I have the patience, energy, and creativity to engage well with children.", 
                    "I believe I can contribute effectively to a ministry focused on children’s growth and faith.",        
                    "I think youth ministry fits my strengths and personality.",
                    "I have thought about working with the youth ministry before."
                ]
            },
            {
                "ministry": "Young Adults",
                "questions": [
                    "I enjoy being in environments where young adults share life experiences and challenges.",
                    "I want to support people in their early career or college years in making faith-based decisions.",
                    "I have the empathy, understanding, and guidance skills needed for this ministry.",
                    "I believe I could connect well with and serve in a young adults ministry.",
                    "I have previously considered joining this ministry."
                ]
            },
            {
                "ministry": "Men's",
                "questions": [
                    "I would enjoy building strong, faith-based relationships with other men.",
                    "I want to help men grow in integrity, leadership, and spiritual strength.",
                    "I have the openness, mentorship skills, and accountability mindset needed here.",
                    "I believe the men’s ministry is an area where I could have a strong impact.",
                    "I have thought about joining the men’s ministry before."
                ]
            },
            {
                "ministry": "Women's",
                "questions": [
                    "I would enjoy a setting where women gather for support, faith, and encouragement.",
                    "I want to help women grow spiritually, emotionally, and in community.",
                    "I have the compassion, leadership, and listening skills suited for women’s ministry.",
                    "I believe I could thrive in a role that uplifts and supports women.",
                    "I have considered joining the women’s ministry in the past."
                ]
            },
            {
                "ministry": "Family Or Couples",
                "questions": [
                    "I would enjoy working in an environment that focuses on strengthening families and marriages.",
                    "I want to support couples and families through events, teaching, or guidance.",
                    "I have the wisdom, patience, and relationship skills needed here.",
                    "I believe I could contribute positively to a ministry focused on families and couples.",
                    "I have thought about joining this ministry before."
                ]
            },
            // Support ministry
            {
                "ministry": "Ushering",
                "questions": [
                    "I would enjoy being in a welcoming, people-focused environment.",
                    "I want to help create a warm and friendly atmosphere during services or events.",
                    "I have the friendliness, alertness, and helpfulness needed for ushering.",
                    "I believe I would do well in a ministry that serves as the first point of contact for guests.",
                    "I have considered serving as an usher before."
                ]
            },
            {
                "ministry": "Hospitality",
                "questions": [
                    "I would enjoy being in a setting where food, comfort, and service are prioritized.",
                    "I want to help prepare and serve food or refreshments for others.",
                    "I have the organization, presentation, and hosting skills needed here.",
                    "I believe I could help make people feel welcomed through hospitality ministry.",
                    "I have thought about joining the hospitality ministry before."
                ]
            },
            {
                "ministry": "Administrative",
                "questions": [
                    "I would enjoy working in an environment that involves organization and planning.",
                    "I want to help manage schedules, records, or communications for the ministry.",
                    "I have the attention to detail, time management, and organization skills needed.",
                    "I believe I could be effective in an administrative role.",
                    "I have considered serving in an administrative capacity before."
                ]
            },
            {
                "ministry": "Finance",
                "questions": [
                    "I would enjoy working in a ministry that handles budgeting and stewardship.",
                    "I want to help manage and track church or ministry finances.",
                    "I have the responsibility, accuracy, and trustworthiness needed for this role.",
                    "I believe I could serve well in a finance or stewardship ministry.",
                    "I have thought about serving in the finance ministry before."
                ]
            },
            {
                "ministry": "Security",
                "questions": [
                    "I would enjoy being in an environment focused on safety and order.",
                    "I am interested in helping maintain safety and well-being during church events.",
        	        "I feel I have the alertness, calmness, and decisiveness needed for security work.",
                    "I believe I could fulfill the role of keeping events safe and orderly.",
                    "I have considered serving in the security ministry before."
                ]
            },
            {
                "ministry": "Facilities Maintenance",
                "questions": [
                    "I would enjoy being in a hands-on, task-focused work environment.",
                    "I am interested in helping maintain, clean, and prepare church spaces.",
                    "I believe I have the practical skills, energy, and attention to detail needed for this role",
                    "I feel capable of contributing effectively to keeping church facilities in good condition.",
                    "I have thought about joining the facilities team before."
                ]
            },
            // Outreach ministry
            {
                "ministry": "Evangelism",
                "questions": [
                    "I would enjoy being in an environment that actively connects with new people.",
                    "I am interested in sharing the message of Jesus through everyday conversations.",
        	        "I feel I have the confidence, friendliness, and openness needed for evangelism.",
                    "I believe I could be effective in reaching out to others with the Gospel.",
                    "I have considered joining an evangelism ministry before."
                ]
            },
            {
                "ministry": "Missions",
                "questions": [
                    "I would enjoy serving in different cultural or unfamiliar environments.",
                    "I want to participate in outreach, whether locally or globally.",
                    "I have the adaptability, teamwork, and openness needed for missions work.",
                    "I believe I could contribute meaningfully in a missions setting.",
                    "I have thought about joining missions work before."
                ]
            },
            {
                "ministry": "Community Service",
                "questions": [
                    "I would enjoy being in an environment focused on serving the community.",
                    "I want to help meet practical needs for people in my area.",
                    "I have the willingness, compassion, and work ethic needed for community service.",
                    "I believe I could make a difference through service-based ministry.",
                    "I have considered joining a community service ministry before."
                ]
            },
            {
                "ministry": "Visitation",
                "questions": [
                    " I like spending time with and encouraging people who are sick, alone, or going through a hard time.",
                    "I want to spend time offering comfort and presence to others.",
                    "I have the empathy, patience, and gentleness needed for visitation work.",
                    "I believe I could offer meaningful support through this ministry.",
                    "I have thought about joining a visitation team before."
                ]
            },
            {
                "ministry": "New Believers",
                "questions": [
                    "I would enjoy helping newcomers in their early faith journey.",
                    "I want to guide others as they develop habits like prayer and Bible reading.",
                    "I have the patience, understanding, and teaching skills needed here.",
                    "I believe I could encourage and equip new believers effectively.",
                    "I have considered joining a ministry for new believers before."
                ]
            },
        // Creative Media ministry
            {
                "ministry": "Production Tech",
                "questions": [
                    "I would enjoy being in a setting that uses technology, screens, and equipment to enhance services.",
                    "I want to help operate sound, video, lighting, or livestream tools.",
                    "I have the technical skill, focus, and adaptability needed for media work.",
                    "I believe I could serve effectively in a tech or media ministry.",
                    "I have considered joining the Production Tech team before."
                ]
            },
            {
                "ministry": "Creative Arts",
                "questions": [
                    "I would enjoy working in a creative space that focuses on visuals and design.",
                    "I want to help communicate church messages through digital or printed graphics.",
                    "I have the creativity, software skills, and attention to detail needed here.",
                    "I believe I could serve well by creating visual materials for the ministry.",
                    "I have thought about joining a Creative Arts or creative team before."
                ]
            },
            {
                "ministry": "Communications & Social Media",
                "questions": [
                    "I would enjoy working in an environment that engages people online.",
                    "I want to create, post, or manage social media content for the church.",
                    "I have the creativity, communication skills, and awareness of trends needed.",
                    "I think I could contribute meaningfully to an online outreach ministry.",
                    "I have considered serving in social media work before."
                ]
            },
            {
                "ministry": "Graphic & Video Design",
                "questions": [
                    "I enjoy capturing moments, events, and stories through photography or videography.",
                    "I want to help document and share church activities through visual content like photos and videos.",
                    "I have the creativity and technical skills needed for photography or video production.",
                    "I believe I could serve well by visually documenting ministry events and projects.",
                    "I have considered joining a media team that handles both photography and video work."
                ]
            },
            // Care & Healing ministry
            {
                "ministry": "Counseling",
                "questions": [
                    "I would feel fulfilled serving in a ministry that supports people through life’s emotional challenges.",
                    "I am interested to help individuals or families find healing and clarity through conversation and prayer.",
        	        "I believe I have the empathy, wisdom, and discretion needed for counseling.",
                    "I believe I could serve well in a role that offers guidance and emotional support.",
                    "I have considered being part of a counseling or care ministry before."
                ]
            },
            {
                "ministry": "Healing & Deliverance",
                "questions": [
                    "I would like to be part of a ministry that focuses on prayer for healing and freedom.",
                    "I would like to pray for people’s physical, emotional, or spiritual restoration.",
                    "I feel I have the sensitivity, discernment, and perseverance for this type of ministry.",
                    "I believe I could serve effectively in healing and deliverance work.",
                    "I have thought about joining a ministry that prays for healing before."
                ]
            },
            {
                "ministry": "Grief & Bereavement",
                "questions": [
                    "I would feel honored to walk alongside people during seasons of grief and loss.",
                    "I am comfortable being present with others in sorrow without needing to give quick answers.",
                    "I have the compassion, gentleness, and stability needed for this ministry.",
                    "I believe I could serve well in comforting those who are grieving.",
                    "I have considered joining a grief support or bereavement ministry before."
                ]
            },
            {
                "ministry": "Addiction Recovery",
                "questions": [
                    "I would be committed to helping people find freedom from harmful habits or addictions.",
                    "I want to support others with grace and patience through the recovery process.",
                    "I have the understanding, encouragement, and nonjudgmental attitude needed for this work.",
                    "I believe I could contribute meaningfully to an addiction recovery ministry.",
                    "I have thought about serving in a recovery or support-based ministry before."
                ]
            },
            {
                "ministry": "Special Needs",
                "questions": [
                    "I would find joy in creating safe and welcoming spaces for people with special needs.",
                    "I want to help individuals of all abilities feel valued and included.",
                    "I have the patience, adaptability, and compassion needed for this ministry.",
                    "I believe I could serve well in supporting people with special needs and their families.",
                    "I have considered joining a ministry that works with individuals with special needs before."
                ]
            },
            // Special Interest ministry
            {
                "ministry": "Seniors",
                "questions": [
                    "I would feel fulfilled serving in a ministry that supports and honors older adults.",
                   "I am interested in spending time listening to and learning from seniors’ life experiences.",
                "I believe I have the patience, kindness, and respect needed to serve elderly individuals.",
                    "I believe I could thrive in a role that offers companionship and practical care for seniors.",
                    "I have considered joining a ministry that serves elderly members of the church before."
                ]
            },
            {
                "ministry": "Single Adults",
                "questions": [
                    "I would enjoy being part of a community that connects and encourages single adults.",
                "I am interested in participating in gatherings that support friendship and faith growth among singles.",
                  "I feel I have the empathy, openness, and encouragement needed for this ministry.",
                    "I believe I could contribute to helping single adults feel supported and connected.",
                    "I have thought about serving in a ministry for single adults before."
                ]
            },
            {
                "ministry": "Marketplace",
                "questions": [
                    "I would find purpose in a ministry that equips people to live out their faith in the workplace.",
                  "I am interested in supporting others to apply biblical values in their careers and leadership.",
                    "I believe I  have the insight, mentorship ability, and networking skills needed for this ministry.",
                    "I believe I could serve well in encouraging professionals to honor God through their work.",
                    "I have considered being part of a marketplace or business-focused ministry before."
                ]
            },
            {
                "ministry": "Sports",
                "questions": [
                  "I would enjoy participating in a ministry that connects with others through sports.",
                   "I am interested in athletic or recreational activities that foster relationships and community.",
                  "I believe I have the teamwork, energy, and leadership skills suited for this ministry.",
                 "I think I could use sports as a way to share faith and encourage others.",
                    "I have thought about joining a sports or recreation ministry before."
                ]
            },
            {
                "ministry": "Writing Publications",
                "questions": [
                    "I would be fulfilled serving in a ministry that shares faith and stories through writing.",
                 "I am interested in creating devotionals, articles, or other written materials to encourage others.",
                    "I believe I have the clarity, creativity, and attention to detail needed for this ministry.",
                    "I believe I could contribute well to a team that produces faith-based publications.",
                    "I have considered serving in a writing or communications ministry before."
                ]
            }
        ];


        let behavioralProfilingScore = [];
        let filteredQuestion = [];
        function showMinistrySpecific() {
            if(ministryInterest.length==0){
                document.getElementById("overlay").style.display = "block";
                document.getElementById("alertMessage").innerText = "It appears that your interest or personal profile doesn't match with the ministries` requirments yet. We encourage you to continue growing in your faith and spiritual journey. When the time is right, we would love to see you involved. God bless you on your path of growth and readiness.";
                console.log("The user's interest or personal profile doesn't match the ministry requirment yet.");
            }
            document.getElementById('step4').classList.add("disable");
            for (let i = 0; i < ministryInterest.length; i++) {
                let ministryName = ministryInterest[i];
                
                // find the ministry object inside ministryQuestions array
                let ministryObj = ministryQuestions.find(m => m.ministry === ministryName); 
                
                if (ministryObj) {
                    filteredQuestion = filteredQuestion.concat(ministryObj.questions);
                }
            }
            showPuzzle("right");
            setTimeout(function() {
                    document.getElementById('ministryCategory').style.display = "none";
                    document.getElementById('l3').classList.add("currentStep");
                    document.getElementById('s4').classList.add("currentStep");
                    document.getElementById("step3").style.display = "none";
                    document.getElementById("step4").style.display = "block";
                    document.getElementById("step4").classList.add("disable");
                    document.getElementById('ministrySpecific').style.display = "block"; 
                    console.log(">>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>");
                    console.log("");
                    console.log(">>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>");
                    console.log(">> Ministry(specific) Profile");
                    showQuestions("ministrySpecific", filteredQuestion, behavioralProfilingScore, "step4");
            }, 3000);
        }

    //display question func
        function showQuestions(portID, question, scorePort, btnId) {
            const port = document.getElementById(portID);

            // render questions
            for (let i = 0; i < question.length; i++) {
                const template = document.getElementById('questionTemp');
                const clone = template.content.cloneNode(true);
                const questionText = clone.querySelector('.questionText');
                const questionBox  = clone.querySelector('.questionBox');

                questionText.innerText = question[i];
                questionBox.dataset.qidx = i;           // <- keep the question index

                if (i !== 0) questionBox.classList.add('denyInput');
                port.appendChild(clone);
                if (i === 0) questionBox.scrollIntoView({ behavior: 'smooth', block: 'center' });
            }

            // ---------- scoring model ----------
            const GROUP_SIZE = 5; // 5 questions per set/port
            const totalQuestions = question.length;
            const portCount = Math.ceil(totalQuestions / GROUP_SIZE);

            // answers[qIdx] holds the last chosen value for that question
            const answers = new Array(totalQuestions).fill(null);

            // make sure scorePort has numeric slots
            for (let p = 0; p < portCount; p++) {
                if (typeof scorePort[p] !== 'number') scorePort[p] = 0;
            }

            let answeredCount = 0; // how many unique questions answered at least once

            // ---------- event delegation ----------
            port.addEventListener('click', (e) => {
                const btn = e.target.closest('.rateBox button');
                if (!btn) return;

                const qBox = btn.closest('.questionBox');
                if (!qBox || qBox.classList.contains('denyInput')) return; // blocked state

                // UI: one clicked per rateBox
                const rateBox = btn.closest('.rateBox');
                rateBox.querySelectorAll('button').forEach(b => b.classList.remove('clicked'));
                btn.classList.add('clicked');

                // which question & which set/port does it belong to?
                const qIdx = parseInt(qBox.dataset.qidx, 10);
                const portIdx = Math.floor(qIdx / GROUP_SIZE);

                // new selected value
                const newVal = parseInt(btn.value, 10);
                if (isNaN(newVal)) return;

                // OVERWRITE logic:
                // if this question had an old answer, remove its contribution first
                if (answers[qIdx] !== null) {
                    scorePort[portIdx] -= answers[qIdx];
                } else {
                    answeredCount++; // first time answering this question
                }

                // store and add the new contribution
                answers[qIdx] = newVal;
                scorePort[portIdx] += newVal;

                // mark current as blurred (still accepts input) and unlock next
                qBox.classList.add('blurred');
                const nextBox = qBox.nextElementSibling;
                if (nextBox && nextBox.classList.contains('questionBox')) {
                    nextBox.classList.remove('denyInput');
                    nextBox.scrollIntoView({ behavior: 'smooth', block: 'center' });
                }

                //log score
                if ((qIdx + 1) % GROUP_SIZE === 0) {
                    console.log(`scorePort[${portIdx + 1}] = ${scorePort[portIdx]}`);
                }

                // enable next-phase button when all questions answered at least once
                if (answeredCount === totalQuestions) {
                    console.log("Final Score: [" + scorePort.join(", ") + "]");
                    const nextBtn = document.getElementById(btnId);
                    if (nextBtn) nextBtn.classList.remove('disable');
                }
            });
        }


        //AI interpretation
        async function interpret(){
            document.getElementById('step4').classList.add("disable");
            console.log(">>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>");
            console.log("");
            console.log(">>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>");
            console.log(">> Interpret Data...");
            showPuzzle("top");
            setTimeout(function() {
                    document.getElementById('ministrySpecific').style.display = "none";
                    document.getElementById('l4').classList.add("currentStep");
                    document.getElementById('s5').classList.add("currentStep");
                    document.getElementById("step4").style.display = "none";
                    document.getElementById("step5").style.display = "block";
                    document.getElementById("step5").classList.add("disable");
                    document.getElementById('responseDiv').style.display = "block";
                    document.getElementById('responseDiv').scrollIntoView({ behavior: 'smooth', block: 'center' });
            }, 3500);
            startThinkingAnimation();

            for (let i = 0; i < behavioralProfilingScore.length - 1; i++) {
                for (let j = i + 1; j < behavioralProfilingScore.length; j++) {
                    if (Number(behavioralProfilingScore[i]) < Number(behavioralProfilingScore[j])) { 
                        // Swap scores
                        const temp = behavioralProfilingScore[i];
                        behavioralProfilingScore[i] = behavioralProfilingScore[j];
                        behavioralProfilingScore[j] = temp;

                        // Swap matching ministries
                        const temp2 = ministryInterest[i];
                        ministryInterest[i] = ministryInterest[j];
                        ministryInterest[j] = temp2;
                    }
                }
            }
            // build the dynamic top list
                let topList = "";
                let least = "";

                for (let i = 0; i < ministryInterest.length; i++) {
                    topList += `top ${i + 1} [${ministryInterest[i]}]`;
                    if (i !== ministryInterest.length - 1) {
                        topList += ", ";
                    }
                    if (i === ministryInterest.length - 1) {
                        least = `${ministryInterest[i]}`;
                    }
                }

                console.log(topList);
                console.log("Lowest: "+least);
                //console.log(ministryInterest.join(", "));

            let message = `
                You are an AI assistant for the Perfit: Am Ai System for matching skills in church ministry.
                A user has completed a test, and their scores are as follows (highest score means top 1):

                List: ${topList}

                Least Aligned Ministry: [${least}]

                Your task is to give interpretation, focusing on the user's divine calling and how ministries align with the user's strengths and purpose. 
                Include a spiritual connection between the top 3 ministries, emphasizing their complementary roles in the user's faith journey.
                display the top 1 with this format:
                <h2 style="color:rgb(128, 65, 128);">Best Fit: [top1 ministry] Ministry</h2>
                //note: make this response 200 words minimum  
                Provide a brief explanation of why this ministry is the user's top fit. 
                Highlight how this ministry aligns with the user's natural gifts, strengths, and passion. 
                Explain that this fit is part of their divine calling, as though this ministry was made for them. 
                Emphasize the alignment between their purpose and this ministry's mission.

                if there is top 2 do this format if not skip it:
                <h2 style="color:rgb(128, 65, 128);">Top 2 Identified Fit: [top2 ministry] Ministry</h2>
                //note: make this response 200 words minimum  
                Provide a brief explanation of why this ministry is the user's second-best fit.
                Focus on how it complements the bestfit, mention its connection.
                Again, explain that this ministry feels like a divine part of their journey,
                something that aligns with their unique gifts and purpose in life.

                if there is top 3 do this format if not skip it:
                <h2 style="color:rgb(128, 65, 128);">Top 3 Identified Fit: [top3 ministry] Ministry</h2>
                //note: make this response 200 words minimum  
                Provide a brief explanation of why this ministry is the user's third-best fit.
                Focus on how it complements their spiritual hobby and quirks.
                Again, explain that this ministry feels like a divine part of their journey,
                something that aligns with their unique gifts and purpose in life.


                Only if there is a top 4 should you display the least aligned ministry in this format; if not, skip it.
                <h2 style="color:rgb(128, 65, 128);">Least Aligned Ministry: [Ministry] Ministry</h2> 
                //note: make this response 150 words minimum  
                Provide a thoughtful and compassionate reflection on why this ministry may have ranked lowest for the user.  
                Emphasize that every ministry plays a vital role in the body of Christ, and a low score does not mean disqualification—it simply highlights a lesser alignment *at this moment*.  
                Encourage the user not to see this as a weakness but as a potential area of spiritual growth.  
                End with a note of affirmation: they are uniquely made, and every ministry—strong or weak—can be a stepping stone in their divine path.


                then display the Spiritual Relationship Between Top Ministries in this format, if there is only 1 ministry skip this:
                <h2 style="color:rgb(128, 65, 128);">Spiritual Relationship Between Top Ministries</h2>
                //note: make this response 200 words minimum
                Explain how these three ministries are connected and complement each other in a spiritual sense. 
                Focus on how their roles support the individual's growth in faith, build on themes like service, prayer, worship, or leadership, and help fulfill the greater mission of the church. 
                Illustrate how the combination of these ministries enhances the user’s role in God's work. 
                
                then display the Growth Opportunities in this format:
                <h2 style="color:rgb(128, 65, 128);">Growth Opportunities:</h2>
                //note: make this response 100 words minimum
                Show how they can grow into their role. Include spiritual, emotional, or skill-based development suggestions. 
                
                then display the Compatibility with Team Dynamics in this format:
                <h2 style="color:rgb(128, 65, 128);">Compatibility with Team Dynamics:</h2>
                //note: make this response 100 words minimum
                Give an insight like "You'd thrive best in teams that are..." (ex. collaborative, structured, spontaneous, etc.) 
                Help them visualize what kind of team culture suits them base on their top ministry. 
                
                then display the Ministry Pathway / Journey Map in this format:
                <h2 style="color:rgb(128, 65, 128);">Ministry Pathway / Journey Map:</h2>
                //note: Put the path way in bullets
                make a possible serving pathway, Help them think long-term, not just one-time serving.
                example:
                - start as an assisstant
                - learn from your senior
                - lead your juniors
                - grow into a leader role. 

                output format:
                <h1 style="color:rgb(128, 65, 128);text-align: center;">CALLING AND SERVICE PROFILE</h1>

                <h2 style="color:rgb(128, 65, 128);">Best Fit: [top1 ministry] Ministry</h2>

                <h2 style="color:rgb(128, 65, 128);">Top 2 Identified Fit: [top2 ministry] Ministry</h2>

                <h2 style="color:rgb(128, 65, 128);">Top 3 Identified Fit: [top3 ministry] Ministry</h2>

                <h2 style="color:rgb(128, 65, 128);">Least Aligned Ministry: [Ministry] Ministry</h2> 

                <h2 style="color:rgb(128, 65, 128);">Spiritual Relationship Between Top Ministries</h2>

                <h2 style="color:rgb(128, 65, 128);">Growth Opportunities:</h2>

                <h2 style="color:rgb(128, 65, 128);">Compatibility with Team Dynamics:</h2>

                <h2 style="color:rgb(128, 65, 128);">Ministry Pathway / Journey Map:</h2>
            `;

                try {
                    const response = await fetch('https://api.openai.com/v1/chat/completions', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                            'Authorization': `Bearer ${apiKey}`
                        },
                        body: JSON.stringify({
                            model: 'gpt-3.5-turbo',
                            messages: [
                                { role: 'system', content: 'You are a helpful church ministry assistant.' },
                                { role: 'user', content: message }
                            ],
                            temperature: 0.7
                        })
                    });

                    if (!response.ok) {
                        const error = await response.text();
                        throw new Error(`OpenAI API error: ${error}`);
                    }

                    const data = await response.json();

                    //Show response
                    stopThinkingAnimation();
                    document.getElementById("responseDiv").innerHTML =
                        data.choices[0].message.content.replace(/\n/g, '<br>');

                } catch (error) {
                    stopThinkingAnimation();
                    console.error("Error:", error);
                    document.getElementById("responseDiv").innerHTML =
                        `<span style="color:red;">Error: ${error.message}</span>`;
                }
            //}
        }


    //thinking loading animation
        let thinkingInterval;
        function startThinkingAnimation() {
            const dots = document.getElementById("dots");
            let dotCount = 1;
            thinkingInterval = setInterval(() => {
                dotCount = (dotCount % 3) + 1;
                dots.textContent = ".".repeat(dotCount);
            }, 500);
            document.getElementById("thinking").style.display = "inline";
        }

        function stopThinkingAnimation() {
            clearInterval(thinkingInterval);
            document.getElementById("thinking").style.display = "none";
            document.getElementById("step5").classList.remove("disable");
        }
    //show puzzle
        function showPuzzle(side){
            document.getElementById(side).classList.add("showPiece");
            document.getElementById('puzzle').scrollIntoView({ behavior: 'smooth' });
            setTimeout(function() {document.getElementById(side).classList.add("highlightPiece");}, 1000);
            setTimeout(function() {document.getElementById(side).classList.remove("highlightPiece");}, 2000);
        }
    //animation
        const moveUp = document.querySelectorAll('.move-up');
        const upObserver = new IntersectionObserver((entries) => {
            entries.forEach(entry => {
                if (entry.isIntersecting) {
                    entry.target.classList.add('visible1');
                }
            });
        }, { threshold: 0.1 });
        moveUp.forEach(el => upObserver.observe(el));
    </script>
    
</body>
</html>